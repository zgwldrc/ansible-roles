- name: Bashrc Alias
  tags: ["deploy", "config", "bashalias"]
  blockinfile:
    path: "/home/{{user}}/.bashrc"
    marker: "# {{item.systemd_name}} svcctl {mark} ANSIBLE MANAGED BLOCK"
    block: |
      export PATH="{{home}}/bin:$PATH"
      alias {{item.systemd_name_short}}status='sudo systemctl status {{item.systemd_name}}.service'
      alias {{item.systemd_name_short}}start='sudo systemctl start {{item.systemd_name}}.service'
      alias {{item.systemd_name_short}}stop='sudo systemctl stop {{item.systemd_name}}.service'
      alias {{item.systemd_name_short}}restart='sudo systemctl restart {{item.systemd_name}}.service'
      alias {{item.systemd_name_short}}log='journalctl -u {{item.systemd_name}}.service -f -n 200 -o cat'
    create: true
    owner: "{{user}}"
    group: "{{group}}"
  loop:
    - {systemd_name_short: "{{systemd_name_short}}", systemd_name: "{{systemd_name}}"}

- name: Add Sudoers File
  tags: ["deploy", "config", "sudorules"]
  blockinfile:
    path: "/etc/sudoers.d/{{user}}"
    create: true
    marker: "# {{item}} {mark} ANSIBLE MANAGED BLOCK"
    block: |
      {{user}} ALL=(root) NOPASSWD: /usr/bin/systemctl start {{item}}.service
      {{user}} ALL=(root) NOPASSWD: /usr/bin/systemctl stop {{item}}.service
      {{user}} ALL=(root) NOPASSWD: /usr/bin/systemctl restart {{item}}.service
      {{user}} ALL=(root) NOPASSWD: /usr/bin/systemctl status {{item}}.service
  loop:
    - "{{systemd_name}}"